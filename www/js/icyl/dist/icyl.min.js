var dependencies=["ionic","icyl.services","icyl.directives","icyl.controllers","w5c.validator"];angular.module("icyl",dependencies).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}]).run(["$rootScope","$state","Identification","User","Alert","CustomNav",function(e,t,n,o,a,r){r.new(),e.$on("$stateChangeStart",function(r,i,s,c){i.access.authenticate&&!n.isAuthenticated()&&(i.access.offline&&i.access.offline!=c.name?t.go(i.access.offline):n.checkToken().then(function(n){0!==n.err_code?(e.actions={toState:i},o.userLogin(e),o.userRegister(e)):t.go(i)},function(e){console.log("错误：Identification.checkToken()"+e),a("请检查网络！")}),r.preventDefault())}),e.$on("$stateChangeSuccess",function(e,t,n,o){var a=-1;o.name&&o.name.indexOf("offline")<0&&(a=r.find(t.name),0>a&&t.name!=o.name?r.record(o.name):r.remove(0,a+1)),o.name.indexOf("offline")>-1&&(a=r.find(t.name),r.remove(0,a+1)),r.fromState=t.name.indexOf("offline")>-1?o.name:""})}]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("main",{url:"/main","abstract":!0,access:{authenticate:!1},templateUrl:"templates/main.html",controller:"mainContainer"}).state("main.default",{url:"/default",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/default.html",controller:"mainDefault"}}}).state("main.news",{url:"/news",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/news.html",controller:"mainNews"}}}).state("main.knowlbase",{url:"/knowlbase",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/knowlbase.html",controller:"mainKnowlBase"}}}).state("main.link",{url:"/link",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/link.html",controller:"mainLink"}}}).state("main.brand",{url:"/brand",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/brand.html",controller:"mainBrand"}}}).state("main.career",{url:"/career",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/career.html",controller:"mainCareer"}}}).state("main.love",{url:"/love",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/love.html",controller:"mainLove"}}}).state("main.beauty",{url:"/beauty",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/beauty.html",controller:"mainBeauty"}}}).state("main.life",{url:"/life",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/life.html",controller:"mainLife"}}}).state("main.sysmgmt",{url:"/sysmgmt",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/sysmgmt.html",controller:"mainSysMgmt"}}}).state("main.loginold",{url:"/loginold",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/main/loginold.html",controller:"mainLoginOld"}}}).state("main.test",{url:"/test",access:{authenticate:!1},views:{"main-container":{templateUrl:"templates/test/test.html",controller:"mainTest"}}}),t.otherwise("/main/default")}]).config(["w5cValidatorProvider",function(e){e.config({blurTrig:!1,showError:!0,removeError:!0}),e.setRules({email:{email:"输入邮箱的格式不正确"},username:{required:"输入的用户名不能为空",pattern:"用户名必须输入字母、数字、下划线,以字母开头"},password:{required:"密码不能为空",minlength:"密码长度不能小于{minlength}",maxlength:"密码长度不能大于{maxlength}"},repeat_password:{repeat:"两次填写的密码不一致"},chinese_name:{required:"姓名不能为空",pattern:"请正确输入中文姓名"},mobile:{required:"手机号不能为空",pattern:"请填写正确手机号",minlength:"手机号长度不能小于{minlength}",maxlength:"手机号长度不能大于{maxlength}"}})}]),angular.module("icyl.controllers",[]).controller("index",["$scope",function(){}]).controller("mainContainer",["$scope","$state","Identification","User","Alert","CustomNav","$window",function(){}]).controller("mainDefault",["$scope","$window","Storage",function(){}]).controller("mainNews",["$scope",function(){}]).controller("mainKnowlBase",["$scope",function(){}]).controller("mainLink",["$scope",function(){}]).controller("mainBrand",["$scope",function(){}]).controller("mainCareer",["$scope",function(){}]).controller("mainLove",["$scope",function(){}]).controller("mainBeauty",["$scope",function(){}]).controller("mainLife",["$scope",function(){}]).controller("mainSysMgmt",["$scope",function(){}]).controller("mainLoginOld",["$scope",function(){}]).controller("mainTest",["$scope",function(e){e.items=[1,2,3];var t=4;e.doRefresh=function(){e.items.push(t),t++,e.items.push(t),t++,e.items.push(t),t++,e.$broadcast("scroll.refreshComplete")},e.loadMoreData=function(){e.items.push(t),t++,e.items.push(t),t++,e.items.push(t),t++,$timeout(function(){e.$broadcast("scroll.infiniteScrollComplete")},1e3)},e.moreDataCanBeLoaded=function(){return!0},e.$on("stateChangeSuccess",function(){e.loadMoreData()})}]).controller("mainMine",["$scope","$ionicNavBarDelegate","$timeout",function(e,t){e.hidebackbutton=function(){t.setTitle("hahahahaha")}}]).controller("mainMineOffline",["$scope",function(){}]).controller("mainAccount",["$scope","User",function(e,t){e.actions={logout:function(){t.userLogout()}}}]).controller("mainUserInfo",["$scope","$state","User","Identification","Alert",function(e,t,n,o,a){n.getUserInfo().then(function(t){0===t.err_code?e.updateUserInfo={name:t.data.Name,gender:!!Number(t.data.Gender),birthday:t.data.Birthday,mobile:t.data.Mobile,email:t.data.Email}:(e.actions={},n.userLogin(e),n.userRegister(e))},function(e){console.log("错误：User.getUserInfo()"+e),a("请检查网络！")}),e.actions={update:function(){o.checkToken().then(function(){n.updateUserInfo(e.updateUserInfo).then(function(o){0===o.err_code?t.go("main.account"):(e.actions={},n.userLogin(e),n.userRegister(e))},function(e){console.log("错误：User.updateUserInfo()"+e),a("请检查网络！")})},function(e){console.log("错误：Identification.checkToken()"+e),a("请检查网络！")})}}}]),angular.module("icyl.directives",[]).directive("customGoBack",["$state","CustomNav",function(e,t){return{restrict:"A",link:function(n,o){o.bind("click",function(){e.go(t.fromState?t.fromState:t.goback()?t.goback():t.defaultback(e.current.name))})}}}]).directive("mineHref",["$state","Storage",function(e,t){return{restrict:"A",link:function(e,n){n[0].href=t.kget("xsunion")&&t.kget("xsunion").length>60?"#/main/sysmgmt":"#/main/loginold"}}}]).directive("iframeSetCookie",["$window","Storage",function(e,t){return{restrict:"E",replace:!0,link:function(n,o,a){function r(n){n=n||e.event,c.contentWindow&&n.data&&i.indexOf(n.origin)>-1&&("ready"==n.data&&cookie&&c.contentWindow.postMessage(cookie,n.origin),n.data.indexOf("xsunion")>-1&&(n.data.length>60?t.kset("xsunion",n.data):t.kremove("xsunion")),0===n.data.indexOf("http://")&&t.kset("socialSharing",n.data))}var i=a.src,s=a.style,c=e.document.createElement("iframe");c.src=i,c.style=s,o[0].appendChild(c),cookie=t.kget("xsunion")?t.kget("xsunion"):!1,e.addEventListener?e.addEventListener("message",r,!1):e.attachEvent("onmessage",r)}}}]).directive("socialSharing",["Storage",function(e){return{restrict:"A",link:function(t,n){e.kremove("socialSharing"),n.bind("click",function(){if(e.kget("socialSharing")){var o=e.kget("socialSharing").split("<$separate$>");console.log(n[0]),console.log(o),document.getElementById("test").innerHTML=o,window.plugins.socialsharing.share(o[2]?o[2]:"这个平台不错的！",null,null,o[0]?o[0]:"http://17f.go5le.net/bootstrap-3.1.1/",function(e){console.log("result: "+e),t.$apply(function(){document.getElementById("test").innerHTML=o[0]+o[2]+o[3]+e})},function(){window.alert("error: "+result)})}})}}}]).directive("openExternal",["$windos",function(e){return{restrict:"E",scope:{url:"=",cookie:"=",exit:"&",loadOpen:"&",loadStop:"&",loadError:"&"},replace:!0,transclude:!0,template:"<a class='button center-block background-clear' ng-click='openUrl()'><span ng-transclude></span></a>",controller:function(t){var n,o=function(){null!==n&&(t.loadOpen&&n.removeEventListener("loadstart",a),t.loadStop&&n.removeEventListener("loadstop",r),t.loadError&&n.removeEventListener("loaderror",t.loadError),t.exit&&n.removeEventListener("exit",o),t.exit())},a=function(){null!==n&&t.loadOpen&&(n.executeScript({code:'document.cookie="'+t.cookie+'";'},function(){}),t.loadOpen())},r=function(){null!==n&&t.loadStop&&(n.executeScript({code:'document.cookie.match(new RegExp("(^| )xsunion=([^;]*)(;|$)"));'},function(){}),t.loadStop())};t.openUrl=function(){n=e.open(encodeURI(t.url),"_blank","location=yes"),t.loadOpen instanceof Function&&n.addEventListener("loadstart",a),t.loadStop instanceof Function&&n.addEventListener("loadstop",r),t.loadError instanceof Function&&n.addEventListener("loaderror",t.loadError),t.exit instanceof Function&&n.addEventListener("exit",o)}}}}]),angular.module("icyl.services",["ngResource"]).constant("USER_ROLES",{all:"*",admin:"admin",editor:"editor",guest:"guest"}).constant("DEFAULT_NAV_TREE",{tree_0:"main.default",tree_0_0:"main.mine",tree_0_1:"main.mineoffline",tree_0_0_0:"main.account",tree_0_0_0_0:"main.userinfo"}).constant("DEFAULT_NAV_TREE_REVERT",{main_mine:"tree_0_0",main_mineoffline:"tree_0_1",main_account:"tree_0_0_0",main_userinfo:"tree_0_0_0_0"}).factory("Storage",["$window",function(e){return{kset:function(t,n){e.localStorage.setItem(t,n)},kget:function(t){return e.localStorage.getItem(t)},kremove:function(t){e.localStorage.removeItem(t)}}}]).service("Session",function(){return this.create=function(e){this.token=e},this.destroy=function(){this.token=null},this}).factory("Alert",["$window",function(e){return function(t){e.alert(t)}}]).service("CustomNav",["DEFAULT_NAV_TREE","DEFAULT_NAV_TREE_REVERT",function(){return this.record=function(e){this.histories.unshift(e)},this.goback=function(){return this.histories[0]},this.new=function(){this.histories=[]},this.remove=function(e,t){this.histories.splice(e,t)},this.find=function(e){return this.histories.indexOf(e)},this.defaultback=function(){return"main.default"},this.fromState="",this}]).factory("Data",["$resource",function(e){return{User:e("http://:baseurl/:path/lp.php",{baseurl:"localhost",path:"PHPServ"},{signin:{method:"POST",params:{c:"user",a:"get_token"},timeout:3e3},signup:{method:"POST",params:{c:"user",a:"register"},timeout:3e3},checktoken:{method:"POST",params:{c:"user",a:"user_verify"},timeout:3e3},updateuserinfo:{method:"POST",params:{c:"user",a:"update_userinfo"},timeout:3e3},update_avatar:{method:"POST"},update_mobile:{method:"POST"},update_password:{method:"POST"}}),Post:e("http://:baseurl/:path/lp.php",{baseurl:"localhost",path:"good"},{signin:{method:"POST",params:{c:"user",a:"get_token"}},singup:{method:"POST",params:{c:"user",a:"register"}}})}}]).factory("User",["$ionicModal","Storage","Data","Alert","$state","Session","$q","$window",function(e,t,n,o,a,r,i){return{userLogin:function(i){i.loginData={username:"alexgzhou",password:"123456789",rememberPwd:!0},e.fromTemplateUrl("templates/common/login.html",{scope:i}).then(function(e){i.loginmodal=e,i.loginmodal.show()}),i.actions.closeLogin=function(){i.loginmodal.hide()},i.actions.login=function(){i.loginmodal.show()},i.actions.preRegister=function(){i.actions.closeLogin(),i.actions.register()},i.actions.doLogin=function(){console.log("正在登录",i.loginData),n.User.signin(i.loginData,function(e){0===e.err_code?(i.loginmodal.remove(),i.loginData.rememberPwd===!0&&t.kset("password",e.data.password),t.kset("username",e.data.username),t.kset("token",e.data.token),r.create(e.data.token),i.loginData.password="",i.actions.toState?a.go(i.actions.toState):a.go(".",{},{reload:!0})):(o(e.err_code+"："+e.err_msg),i.loginData.password="")},function(e){o("请检查网络！！！"),console.log(" request fail for login !!!!! "+e)})}},userRegister:function(t){t.registerData={gender:!1},e.fromTemplateUrl("templates/common/register.html",{scope:t}).then(function(e){t.registermodal=e}),t.actions.closeRegister=function(){t.registermodal.hide()},t.actions.register=function(){t.registermodal.show()},t.actions.prelogin=function(){t.actions.closeRegister(),t.actions.login()},t.actions.doRegister=function(){console.log("正在注册",t.registerData),n.User.signup(t.registerData,function(n){0===n.err_code?(t.registermodal.remove(),e.fromTemplateUrl("templates/common/register.html",{scope:t}).then(function(e){t.registermodal=e}),t.loginData={username:t.registerData.username,rememberPwd:!0},t.registerData={gender:!1},t.actions.login()):(o(n.err_code+"："+n.err_msg),t.registerData.password="",t.registerData.repeatpassword="")},function(e){o("请检查网络！！！"),console.log(" request fail for register !!!!! "+e)})}},userLogout:function(){r.destroy(),t.kremove("password"),t.kremove("token"),a.go("main.mine")},getUserInfo:function(){var e=i.defer();return n.User.checktoken({token:r.token},function(t){e.resolve(t)},function(t){o("请检查网络！！！"),console.log(" request fail for getUserInfo !!!!! "+t),e.resolve(t)}),e.promise},updateUserInfo:function(e){var t=i.defer();return e.token=r.token,n.User.updateuserinfo(e,function(e){t.resolve(e)},function(e){o("请检查网络！！！"),console.log(" request fail for updateUserInfo !!!!! "+e),t.resolve(e)}),t.promise}}}]).factory("PageInit",["User","$compile",function(){return{}}]).factory("Identification",["Storage","Data","Alert","Session","$q",function(e,t,n,o,a){return{checkToken:function(){var r=a.defer();if(e.kget("username")&&e.kget("password"))o.token?t.User.checktoken({token:o.token},function(a){0===a.err_code?r.resolve(a):t.User.signin({username:e.kget("username"),password:e.kget("password")},function(t){0===t.err_code?(e.kset("token",t.data.token),o.create(t.data.token),r.resolve(t)):r.resolve(t)},function(e){n("请检查网络！！！"),console.log(" request fail for get_token !!!!! "+e),r.resolve(e)})},function(e){n("请检查网络！！！"),console.log(" request fail for check_token !!!!! "+e),r.resolve(e)}):t.User.signin({username:e.kget("username"),password:e.kget("password")},function(t){0===t.err_code?(e.kset("token",t.data.token),o.create(t.data.token),r.resolve(t)):r.resolve(t)},function(e){n("请检查网络！！！"),console.log(" request fail for get_token !!!!! "+e),r.resolve(e)});else if(o.token)t.User.checktoken({token:o.token},function(e){r.resolve(0===e.err_code?e:e)},function(e){n("请检查网络！！！"),console.log(" request fail for check_token without username and password !!!!! "+e),r.resolve(e)});else{var i={};i.err_code=-999,r.resolve(i)}return r.promise},isAuthenticated:function(){return!!o.token}}}]);